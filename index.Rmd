---
title: ""
output:
  html_document:
  css: style.css
  
---


<p align = "justify">

<font size = "4"> Data analysis for: </font>

<font size = "5"> The Foraging-mode Paradigm: A Historical Overview Including a Reevaluation of its Predictions</font>

[Dylan Padilla](https://dylanpadilla.netlify.app/), School of Life Sciences, Arizona State University, Tempe, AZ 85287, United States.

![](imgs/asu_logo.png)


```{r, include = FALSE}

knitr::opts_chunk$set(fig.align = "center", fig.width = 7, fig.height = 7, dpi = 300, comment = ">")

```

<b>
<font size = "4"> Library </font>
</b>

```{r}

library(AICcmodavg)
library(emo)
library(icons)
library(magick)
library(knitr)
library(MuMIn)
library(png)
library(raster)
library(scales)
library(vioplot)
library(xtable)

```

<b>
<br>
<font size = "4"> Loading data </font>
<br>
</b>


```{r, include = FALSE}

##data <- data.frame(initial_mass = rep(NA, 100), final_mass = rep(NA, 100), strain = rep(NA, 100), env = rep(NA, 100), adult = rep(NA, 100))
##head(data)

##write.table(data, file = "data.csv", sep = ",", row.names = FALSE)

```


```{r}

data <- read.csv("data.csv")
head(data)
data$growth <-  data$final_mass - data$initial_mass
names(data)

data <- data[ , c(3, 4, 7)]
data <- data[!is.na(data$growth), ]
data <- data[data$growth > 0, ]

table(data$strain, data$env)

data$strain[data$strain == "s"] <- "Sitter"
data$strain[data$strain == "r"] <- "Rover"
data$env[data$env == "p"] <- "Patchy"
data$env[data$env == "u"] <- "Lumpy"

data <- data[data$growth < 0.002, ] # Removing abnormal data


## Movement data

vid.dat <- read.csv('./OneDrive-2024-08-19/Results/Results_by_ind.csv', row.names = 1, sep = ';')
str(vid.dat)
vid.dat <- vid.dat[c(2, 4, 1, 3, 5:92), ]
vid.dat[1:8, 1:5]

mov.dat <- read.csv('movement.csv')
str(mov.dat)
head(mov.dat)

s <- mov.dat[mov.dat$strain == "s", ]
r <- mov.dat[mov.dat$strain == "r", ]
dim(s)
dim(r)

ord.dat <- data.frame()

for(i in 1:46){
    idx <- s[i, ]
    idx2 <- r[i, ]
    obj <- rbind(idx, idx2)
    ord.dat <- rbind(ord.dat, obj)
}

ord.dat[1:8, ]
vid.dat[1:8, 1:5]
dim(ord.dat)

vid.dat$mass <- ord.dat$mass
vid.dat$strain <- ord.dat$strain
vid.dat$env <- ord.dat$env

## Proportion of area visited

area.dat <- read.csv('Proportion-of-area-visited.csv', sep = ';')
area.dat <- area.dat[c(2, 4, 1, 3, 5:92), ]
vid.dat$prop_area_visited <- area.dat[ , 2]

names(vid.dat)

str(vid.dat)
data.frame(vid.dat[1:12, 10:11])

```

<b>
<br>
<font size = "4"> Modeling foraging behavior and growth</font>
<br>
</b>

```{r}

##vid.dat <- vid.dat[vid.dat$Prop_time_moving > 0.7, ] ## extreme value
vid.dat$env[vid.dat$env == 'u'] <- 'Lumpy'
vid.dat$env[vid.dat$env == 'p'] <- 'Patchy'
vid.dat$strain[vid.dat$strain == 'r'] <- 'Rover'
vid.dat$strain[vid.dat$strain == 's'] <- 'Sitter'
str(vid.dat)


## Proportion of area covered


mod <- lm(prop_area_visited ~ mass*strain*env, data = vid.dat)
summary(mod)

mod1 <- lm(prop_area_visited ~ mass*strain + env, data = vid.dat)
summary(mod1)

mod2 <- lm(prop_area_visited ~ strain*env, data = vid.dat)
summary(mod2)
anova(mod2)

mod3 <- lm(prop_area_visited ~ strain + env, data = vid.dat)
summary(mod3)
anova(mod3)

## Model selection procedure based on AIC criterion

output.models <- model.sel(mod1, mod2, mod3)

sel.table <- round(as.data.frame(output.models)[7:11], 3)
names(sel.table)[1] <- "K"
sel.table$Model <- rownames(sel.table)
sel.table <- sel.table[ , c(6, 1, 2, 3, 4, 5)]
sel.table

xtable(sel.table, digits = 3, caption = 'Caption here')

## Model diagnosis

layout(matrix(c(0, 0, 0, 0,
                1, 1, 2, 2,
                1, 1, 2, 2,
                0, 0, 0, 0), nrow = 4, ncol = 4, byrow = TRUE))



## Checking homogeneity of variance


plot(fitted(mod3), resid(mod3), col = "grey", pch = 20, xlab = "Fitted", ylab = "Residual", main = "Fitted versus Residuals", type = 'n', las = 1)
grid()

par(new = TRUE)
plot(fitted(mod3), resid(mod3), col = "grey", pch = 20, xlab = "Fitted", ylab = "Residual", main = "Fitted versus Residuals", las = 1)

abline(h = 0, col = "darkorange", lwd = 2)


## Checking normality

qqnorm(resid(mod3), col = "darkgrey", type = 'n', las = 1)
grid()

par(new = TRUE)
qqnorm(resid(mod3), col = "darkgrey", las = 1)
qqline(resid(mod3), col = "dodgerblue", lwd = 2)



## Distance traveled

mod4 <- lm(Traveled_Dist_Moving ~ mass*strain + env, data = vid.dat)
summary(mod4)

mod5 <- lm(Traveled_Dist_Moving ~ strain*env, data = vid.dat)
summary(mod5)
anova(mod5)

mod6 <- lm(Traveled_Dist_Moving ~ strain + env, data = vid.dat)
summary(mod6)
anova(mod6)

mod7 <- lm(Traveled_Dist_Moving ~ strain, data = vid.dat)
summary(mod7)
anova(mod7)


## Model selection procedure based on AIC criterion

output.models <- model.sel(mod4, mod5, mod6, mod7)

sel.table <- round(as.data.frame(output.models)[7:11], 3)
names(sel.table)[1] <- "K"
sel.table$Model <- rownames(sel.table)
sel.table <- sel.table[ , c(6, 1, 2, 3, 4, 5)]
sel.table


## Model diagnosis


layout(matrix(c(0, 0, 0, 0,
                1, 1, 2, 2,
                1, 1, 2, 2,
                0, 0, 0, 0), nrow = 4, ncol = 4, byrow = TRUE))



## Checking homogeneity of variance


plot(fitted(mod6), resid(mod6), col = "grey", pch = 20, xlab = "Fitted", ylab = "Residual", main = "Fitted versus Residuals", type = 'n', las = 1)
grid()

par(new = TRUE)
plot(fitted(mod6), resid(mod6), col = "grey", pch = 20, xlab = "Fitted", ylab = "Residual", main = "Fitted versus Residuals", las = 1)

abline(h = 0, col = "darkorange", lwd = 2)


## Checking normality

qqnorm(resid(mod6), col = "darkgrey", type = 'n', las = 1)
grid()

par(new = TRUE)
qqnorm(resid(mod6), col = "darkgrey", las = 1)
qqline(resid(mod6), col = "dodgerblue", lwd = 2)




## Growth rate

int.model <- lm(growth ~ strain*env, data = data)
summary(int.model)
anova(int.model)

noint.model <- lm(growth ~ strain + env, data = data)
summary(noint.model)
anova(noint.model)

## Model selection procedure based on AIC criterion

output.models <- model.sel(int.model, noint.model)

sel.table <- round(as.data.frame(output.models)[5:9], 3)
names(sel.table)[1] <- "K"
sel.table$Model <- rownames(sel.table)
sel.table <- sel.table[ , c(6, 1, 2, 3, 4, 5)]
sel.table

xtable(sel.table, digits = 3, caption = 'Caption here')

## Model diagnosis


layout(matrix(c(0, 0, 0, 0,
                1, 1, 2, 2,
                1, 1, 2, 2,
                0, 0, 0, 0), nrow = 4, ncol = 4, byrow = TRUE))



## Checking homogeneity of variance


plot(fitted(noint.model), resid(noint.model), col = "grey", pch = 20, xlab = "Fitted", ylab = "Residual", main = "Fitted versus Residuals", type = 'n', las = 1)
grid()

par(new = TRUE)
plot(fitted(noint.model), resid(noint.model), col = "grey", pch = 20, xlab = "Fitted", ylab = "Residual", main = "Fitted versus Residuals", las = 1)

abline(h = 0, col = "darkorange", lwd = 2)


## Checking normality

qqnorm(resid(noint.model), col = "darkgrey", type = 'n', las = 1)
grid()

par(new = TRUE)
qqnorm(resid(noint.model), col = "darkgrey", las = 1)
qqline(resid(noint.model), col = "dodgerblue", lwd = 2)


```

```{r}

## Proportion of area covered

xtable(data.frame(anova((mod3))), caption = 'Caption here...', digits = 3)


## Growth

xtable(formatC(as.matrix(anova(noint.model)), digits = 3, format = 'e'), caption = 'Caption here...', digits = 3)

```

<b>
<br>
<font size = "4"> Plotting results of the model </font>
<br>
</b>


```{r}

## Barplot

## png('figure2.png', height = 7, width = 7, units = 'in', res = 350)

## Let's calculate the average value for each condition and each specie with the 'tapply' function

mean.area <- tapply(vid.dat$prop_area_visited, list(vid.dat$strain, vid.dat$env), mean)
as.matrix(mean.area)

## Plot boundaries

lim <- 2*max(mean.area)

## A function to add arrows on the chart

error.bar <- function(x, y, upper, lower = upper, length = 0.1,...){
  arrows(x, y+upper, x, y-lower, angle = 90, code = 3, length = length, ...)
}
 
## Then I calculate the standard deviation for each specie and condition :

std.area <- tapply(vid.dat$prop_area_visited, list(vid.dat$strain, vid.dat$env), sd)
std.area
stdev.area <- as.matrix(std.area*1.96/46)

## I am ready to add the error bar on the plot using my "error bar" function!

cols <- c("black" , "gray")

par(mar = c(5, 6, 1, 1), mgp = c(3.8, 1, 0))

ze_barplot <- barplot(NA, beside = TRUE, legend.text = T, col = alpha(cols, 0.2), ylim = c(0, lim), ylab = expression(paste('Proportion of area visited')~(mm^2)), xlab = "Environment", las = 1)
grid()

par(new = TRUE)
ze_barplot <- barplot(mean.area, beside = TRUE, legend.text = T, col = alpha(cols, 0.5) , ylim = c(0, lim), ylab = expression(paste('Proportion of area visited')~(mm^2)), xlab = "Environment", las = 1)
error.bar(ze_barplot, mean.area, stdev.area, col = "black")
box()

## dev.off()

```


```{r}

## Barplot

## png('figure2.png', height = 7, width = 7, units = 'in', res = 350)

## Let's calculate the average value for each condition and each specie with the 'tapply' function

mean.gr <- tapply(data$growth, list(data$strain, data$env), mean)
as.matrix(mean.gr)

## Plot boundaries

lim <- 2*max(mean.gr)

## A function to add arrows on the chart

error.bar <- function(x, y, upper, lower = upper, length = 0.1,...){
  arrows(x, y+upper, x, y-lower, angle = 90, code = 3, length = length, ...)
}
 
## Then I calculate the standard deviation for each specie and condition :

std.gr <- tapply(data$growth, list(data$strain, data$env), sd)
std.gr
stdev <- as.matrix(std.gr*1.96/46)

## I am ready to add the error bar on the plot using my "error bar" function!

cols <- c("black" , "gray")

par(mar = c(5, 6, 1, 1), mgp = c(3.8, 1, 0))

ze_barplot <- barplot(NA, beside = TRUE, legend.text = T, col = alpha(cols, 0.2), ylim = c(0, lim), ylab = expression(Growth~(Delta*gr%*%day^-1)), xlab = "Environment", las = 1)
grid()

par(new = TRUE)
ze_barplot <- barplot(mean.gr, beside = TRUE, legend.text = T, col = alpha(cols, 0.5) , ylim = c(0, lim), ylab = expression(Growth~(Delta*gr%*%day^-1)), xlab = "Environment", las = 1)
error.bar(ze_barplot, mean.gr, stdev, col = "black")
box()

## dev.off()

```

<b>
<br>
<font size='3'>Figure 1</font>
<br>
</b>

```{r, eval = FALSE}


for(i in 1:23){
    
    png(paste('figure', i, '.png', sep = ''), width = 7, height = 7, units = 'in', res = 350)
    
    layout(matrix(c(1, 1, 2, 2,
                    1, 1, 2, 2,
                    3, 3, 4, 4,
                    3, 3, 4, 4), nrow = 4, ncol = 4, byrow = TRUE))
    
    RP <- readPNG(source = paste('imgs/RP-path/figure', i, '.png', sep = ''))
    SP <- readPNG(source = paste('imgs/SP-path/figure', i, '.png', sep = ''))
    RU <- readPNG(source = paste('imgs/RU-path/figure', i, '.png', sep = ''))
    SU <- readPNG(source = paste('imgs/SU-path/figure', i, '.png', sep = ''))
    play <- readPNG('imgs/play-button.png')
    
    par(mar = c(2.5, 1, 1, 0))
    plot(NA, ylim = c(0, 1), xlim = c(0, 1), type = 'n', axes = FALSE, xlab = '', ylab = '', main = 'Rovers')
    par(new = TRUE)
    rasterImage(RP, 0, 0, 1, 1)
    mtext('A', at = 0, line = -0.5)

    par(mar = c(2.5, 1, 1, 0))
    plot(NA, ylim = c(0, 1), xlim = c(0, 1), type = 'n', axes = FALSE, xlab = '', ylab = '', main = 'Sitters')
    par(new = TRUE)
    rasterImage(SP, 0, 0, 1, 1)

    par(mar = c(2.5, 1, 1, 0))
    plot(NA, ylim = c(0, 1), xlim = c(0, 1), type = 'n', axes = FALSE, xlab = '', ylab = '')
    par(new = TRUE)
    rasterImage(RU, 0, 0, 1, 1)
    mtext('B', at = 0, line = -0.5)

   
    par(mar = c(2.5, 1, 1, 0))
    plot(NA, ylim = c(0, 1), xlim = c(0, 1), type = 'n', axes = FALSE, xlab = '', ylab = '')
    par(new = TRUE)
    rasterImage(SU, 0, 0, 1, 1)

    par(xpd = TRUE)
    rasterImage(play, -0.08, 0, 0.02, 0.11)
    
    dev.off()
}


```

![](imgs/figure1.gif)

<br>

<b>
<br>
<font size='3'>Figure 2</font>
<br>
</b>

```{r}

##png('figure2.png', width = 7, height = 7, units = 'in', res = 350)


layout(matrix(c(0, 1, 1, 0,
                0, 1, 1, 0,
                0, 2, 2, 0,
                0, 2, 2, 0), nrow = 4, ncol = 4, byrow = TRUE))


par(mar = c(5, 6, 1, 1), mgp = c(3.8, 1, 0))

lim <- 2*max(mean.area)

ze_barplot <- barplot(NA, beside = TRUE, legend.text = T, col = alpha(cols, 0.2), ylim = c(0, lim), ylab = expression(paste('Proportion of area visited')~(mm^2)), xlab = "Environment", las = 1)
grid()

par(new = TRUE)
ze_barplot <- barplot(mean.area, beside = TRUE, legend.text = T, col = alpha(cols, 0.5) , ylim = c(0, lim), ylab = expression(paste('Proportion of area visited')~(mm^2)), xlab = "Environment", las = 1)
error.bar(ze_barplot, mean.area, stdev.area, col = "black")
box()
mtext('A', at = -0.45, line = -0.5)


par(mar = c(5, 6, 1, 1), mgp = c(3.8, 1, 0))

lim <- 2*max(mean.gr)

ze_barplot <- barplot(NA, beside = TRUE, legend.text = T, col = alpha(cols, 0.2), ylim = c(0, lim), ylab = expression(Growth~(Delta*gr%*%day^-1)), xlab = "Environment", las = 1)
grid()

par(new = TRUE)
ze_barplot <- barplot(mean.gr, beside = TRUE, legend.text = T, col = alpha(cols, 0.5) , ylim = c(0, lim), ylab = expression(Growth~(Delta*gr%*%day^-1)), xlab = "Environment", las = 1)
error.bar(ze_barplot, mean.gr, stdev, col = "black")
box()
mtext('B', at = -0.45, line = -0.5)

##dev.off()

```

<br>
<b>
<font size='3'>Violin plots</font>
</b>
<br>


```{r}

##png("figure2-revised.png", height = 7, width = 7, units = "in", res = 360)

layout(matrix(c(0, 1, 1, 0,
                0, 1, 1, 0,
                0, 2, 2, 0,
                0, 2, 2, 0), nrow = 4, ncol = 4, byrow = TRUE))

## Basic boxplot

par(mgp = c(2, 1, 0))

vioplot(prop_area_visited ~ strain + env, data = vid.dat, border = NA, method = "jitter", side = "right", ylab = expression(paste("Proportion of area visited")~(mm^2)), xlab = "Environment", col = "white", las = 1, xaxt = 'n', ylim = c(0, 0.45))

grid(nx = NULL, ny = NULL, col = alpha("lightgray", 0.5), lwd = 1, lty = 2)

par(new = TRUE)

vioplot(prop_area_visited ~ strain + env, data = vid.dat, border = NA, method = "jitter", side = "right", ylab = "", xlab = "", col = c(alpha("purple", 0.2), alpha("orange", 0.2)), las = 1, xaxt = 'n', ylim = c(0, 0.45))
axis(1, at = c(1.5, 3.5), labels = c('Uniform', 'Patchy'), cex = 0.8)

legend('topleft', legend = c('Rover', 'Sitter'), cex = 0.8, fill = c(alpha("purple", 0.2), alpha("orange", 0.2)), bty = 'n')

stripchart(prop_area_visited ~ strain + env, data = vid.dat, vertical = TRUE, method = "jitter", add = TRUE, pch = 20, col = c(alpha("purple", 0.3), alpha("orange", 0.5)), cex = 1.3)

mtext("A", side = 2, at = 0.5, line = 3, las = 1, font = 1)


## Basic boxplot

par(mgp = c(3, 1, 0))

vioplot(growth ~ strain + env, data = data, border = NA, method = "jitter", side = "right", ylab = expression(Growth~(Delta*gr%*%day^-1)), xlab = "Environment", col = "white", las = 1, xaxt = 'n')

grid(nx = NULL, ny = NULL, col = alpha("lightgray", 0.5), lwd = 1, lty = 2)

par(new = TRUE)

vioplot(growth ~ strain + env, data = data, border = NA, method = "jitter", side = "right", ylab = "", xlab = "", col = c(alpha("purple", 0.2), alpha("orange", 0.2)), las = 1, xaxt = 'n')
axis(1, at = c(1.5, 3.5), labels = c('Uniform', 'Patchy'), cex = 0.8)

stripchart(growth ~ strain + env, data = data, vertical = TRUE, method = "jitter", add = TRUE, pch = 20, col = c(alpha("purple", 0.3), alpha("orange", 0.5)), cex = 1.3)

mtext("B", side = 2, at = 0.00096, line = 3, las = 1, font = 1)

legend('topright', legend = c('Rover', 'Sitter'), cex = 0.8, fill = c(alpha("purple", 0.2), alpha("orange", 0.2)), bty = 'n')

##dev.off()

```

